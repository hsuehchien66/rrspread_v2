## Functions:

### Match_tree_meta

#### Input:

**Metadata**: metadata file

**Tree**: tree file generated from Gubbins

**drop_tip_name**: the name of the tip to be dropped, usually the reference name

**drop_tip**: TRUE to drop the tip of drop_tip_name

#### Output:

a list of:

-   matched and ordered metadata table

-   dropRef_tree

**Warning**:

check manually the tip and laneid

------------------------------------------------------------------------

### Time_resolved

#### Input:

**match_tree_meta**: metadata table generated by match_tree_meta

**dropRef_tree**: tree file generated from Gubbins without reference tip

**save_bd_path**: path to save the bactdating results

**time**: column name of collection time in match_tree_meta (optional)

#### Output: a list of

-   Root2tip object

-   Bactdating results

**Warning**:

check the positive correlation between roottotip distance and collection time manually

------------------------------------------------------------------------

### gen_dist_mat 

#### Input:

**metadata**: metadata table generated by match_tree_meta

**min_dist**: distance minimum threshold

**max_dist**: distance maximum threshold

#### Output: a list of

-   pairwise distance numeric matrix

-   pairwise distance binary matrix (whether the distance between pairs are within min_dist and max_dist)

------------------------------------------------------------------------

### gen_divtime_mat 

#### Input:

**metadata**: metadata table generated by match_tree_meta

**bactdate_tree**: tree output generated by bactdacting

**min_time**: minimum divergence time threshold

**max_time**: maximum divergence time threshold

#### Output: a list of

-   pairwise divergence time numeric matrix

-   pairwise divergence time binary matrix (whether the divergence time between pairs are within min_time and max_time)

------------------------------------------------------------------------

### RR_matrix:

#### Input:

**meta_table** : metadata file (see *"Required Input Data"* section)

**bactdat_tree**: tree file generated from *Time_resolved*

**coltime_range**: range of pairwise collection time difference (year), default 1 year

**des_divtime_min**: minimum designated/targeted divergence time, numerator

**des_divtime_max**: maximum designated/targeted divergence time, numerator

**ref_divtime_min**: minimum reference divergence time, denominator

**ref_divtime_max**: minimum reference divergence time, denominator

**des_distance_min**: minimum designated/targeted distance, numerator

**des_distance_max**: maximum designated/targeted distance, numerator

**ref_distance_min**: minimum reference distance, denominator

**ref_distance_max**: maximum reference distance, denominator

#### Output:

-   pairwise designated lineage binary matrix

-   pairwise reference lineage binary matrix

-   pairwise designated location binary matrix

-   pairwise reference location binary matrix

-   pairwise designated distance binary matrix

-   pairwise reference distance binary matrix

-   pairwise designated divergence time binary matrix

-   pairwise reference divergence time binary matrix

-   pairwise distance matrix

-   pairwise divergence matrix

-   pairwise collection time binary matrix

**Warning**

manually check divergence time distribution, distance distribution

------------------------------------------------------------------------

### Geo_Strain_Calc_RR:

#### Input:

**x**: subsampling parameter

**des_geo_matrix**: pairwise designated location binary matrix / pairwise designated distance binary matrix generated by *RR_matrix*

**ref_geo_matrix**: pairwise reference location binary matrix / pairwise reference distance binary matrix generated by *RR_matrix*

**des_strain_matrix**: pairwise designated lineage binary matrix / pairwise designated divergence time binary matrix generated by *RR_matrix*

**ref_strain_matrix**: pairwise reference lineage binary matrix / pairwise reference divergence time binary matrix generated by *RR_matrix*

**colyear_matrix**: pairwise collection time binary matrix generated by *RR_matrix*

#### Output:

-   Relative Risk ratio

------------------------------------------------------------------------

### RR_bootstrap:

#### Input:

**metadataset**: metadata, should include region, information

**des_geo_matrix**: pairwise designated location binary matrix / pairwise designated distance binary matrix generated by RR_matrix

**ref_geo_matrix**: pairwise reference location binary matrix / pairwise reference distance binary matrix generated by RR_matrix

**des_strain_matrix**: pairwise designated lineage binary matrix / pairwise designated divergence time binary matrix generated by RR_matrix

**ref_strain_matrix**: pairwise reference lineage binary matrix / pairwise reference divergence time binary matrix generated by RR_matrix

**colyear_matrix**: pairwise collection time binary matrix generated by RR_matrix

**nboot**: number of bootstrap

**subsample_min**: subsampling parameter

#### Output:

* A dataframe of Relative Risk Ratio with confidence interval

------------------------------------------------------------------------